<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>04_Promise理解</title>
</head>
<body>
  <!-- 
  Promise是什么?
  1.抽象表达: 
      1) Promise是一门新的技术(ES6规范)
      2) Promise是JS中进行异步编程的新解决方案(旧的是谁?)
  2.具体表达:
      1) 从语法上来说: Promise是一个构造函数
      2) 从功能上来说: promise对象用来封装一个异步操作并可以获取其成功/失败的结果值
  -->
<script type="text/javascript">

  //初识Promise
  /*var promise1 = new Promise(function(resolve, reject) { //执行器函数(excutor),它是同步的回调
    //当我们new了一个Promise实例后，实例自身的状态是：初始化状态(pending)
    //执行器函数中，写异步代码
    setTimeout(function() {
      //resolve('foo'); //调用resolve，可以将Promise实例对象由 初始化状态(pending) 变为 成功状态(resolved)，同时指定成功的value
      reject('失败了') //调用reject，可以将Promise实例对象由 初始化状态(pending) 变为 失败状态(rejected)，同时指定失败的reason
    },1000);
  });

  promise1.then(
    value => console.log(value), //Promise实例成功状态所对相应的回调函数，它是异步的回调
    reason => console.log(reason), //Promise实例成功状态所对相应的回调函数，它是异步的回调
  );

  console.log(promise1);*/

  //使用Promise+xhr包装一个ajax请求
  function myAsyncFunction(url) {
    return new Promise((resolve, reject) => {
      const xhr = new XMLHttpRequest();
      xhr.open("GET", url);
      xhr.onload = () => resolve(JSON.parse(xhr.response));
      xhr.onerror = () => {
        reject(xhr.statusText);
      }
      xhr.send();
    });
  };

  myAsyncFunction('https://api.apiopen.top/musicRankingsDetails?type=1').then(
    value => console.log('onResolved',value),
    reason => console.log('onRejected',reason)
  )



</script>
</body>
</html>